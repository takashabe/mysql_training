## レプリケーションとは

* 1つのMySQLサーバ(マスタ)のデータを、1つまたは複数のMySQLサーバ(スレーブ)に複製出来る

## レプリケーションのメリット

* パフォーマンス
  * マスタは更新専用(UPDATE, INSERT, DELETE等), スレーブは参照専用(SELECT)にすることで負荷が分散する
  * 一般的なWebアプリケーションでは読み取り負荷の方が多い傾向にあるため、レプリケーションでは参照性能向上の恩恵が大きい
* バックアップ
  * データはスレーブに複製され、スレーブはレプリケーションプロセスを一時停止できるため、スレーブで安全なコールドバックアップが取得可能
* 分析
  * マスタに負荷をかけずにスレーブの情報を分析可能

## レプリケーションの仕組み

* マスタ
  * Binlogダンプスレッド
    * バイナリログを生成
* スレーブ
  * スレーブI/Oスレッド
    * マスタに接続し、対象のバイナリログの更新を送信要求する
    * マスタのBinlogダンプスレッドから送信される更新を読み取り、リレーログとしてスレーブ側のローカルにコピーする
  * スレーブSQLスレッド: スレーブI/Oスレッドによって
    * スレーブI/Oスレッドによって書き込まれたリレーログを読み取り、SQLを実行する

## レプリケーションの種類

* バイナリログの種類
  * ステートメントベースレプリケーション(SBR)
    * デフォルト
    * SQLをバイナリログに書き込む
    * ファイルサイズは小さい
    * 非決定性関数を使った場合にスレーブで不整合が生じる可能性がある
      * UUID(), RAND()など
      * `UPDATE foo SET id = UUID()...` のようなクエリがそのまま転送されるため
  * 行ベースレプリケーション(RBR)
    * 更新結果をバイナリログに書き込む
    * ファイルサイズは大きい
  * 混合(Mixed)
    * 通常時はSBRで書き込み
    * 関数にUUID()が含まれる、FOUND_ROWS()などが含まれるときはRBRに切り替わる
